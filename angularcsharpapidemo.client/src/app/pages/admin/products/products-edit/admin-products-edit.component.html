<div class="min-h-screen ml-64 p-6 bg-gray-50">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900">{{ pageTitle }}</h1>
    <p class="text-gray-600 mt-1">
      {{ isEditMode ? 'Update product information' : 'Create a new product for your catalog' }}
    </p>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="bg-white rounded-lg shadow p-8 text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-2 text-gray-600">Loading product...</p>
    </div>
  }

  <!-- Form -->
  @if (!isLoading()) {
    <div class="bg-white rounded-lg shadow">
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <div class="p-6 space-y-6">
          <!-- Success Message -->
          @if (successMessage()) {
            <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg flex items-center">
              <ng-icon name="lucideCheck" class="mr-2" />
              {{ successMessage() }}
            </div>
          }

          <!-- Error Message -->
          @if (errorMessage()) {
            <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg flex items-center">
              <ng-icon name="lucideX" class="mr-2" />
              {{ errorMessage() }}
            </div>
          }

          <!-- Product Name Field -->
          <div>
            <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
              Product Name <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="name"
              formControlName="name"
              placeholder="e.g., Wireless Headphones, Cotton T-Shirt"
              class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-gray-500"
              [class.border-red-500]="hasError('name', 'required') || hasError('name', 'minlength') || hasError('name', 'maxlength')"
              [class.border-gray-300]="!hasError('name', 'required') && !hasError('name', 'minlength') && !hasError('name', 'maxlength')"
            />
            @if (hasError('name', 'required') || hasError('name', 'minlength') || hasError('name', 'maxlength')) {
              <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('name') }}</p>
            } @else {
              <p class="mt-1 text-sm text-gray-500">Enter a descriptive product name (1-200 characters)</p>
            }
          </div>

          <!-- Description Field -->
          <div>
            <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
              Description <span class="text-red-500">*</span>
            </label>
            <textarea
              id="description"
              formControlName="description"
              rows="4"
              placeholder="Describe the product features, specifications, and benefits..."
              class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-gray-500"
              [class.border-red-500]="hasError('description', 'required') || hasError('description', 'minlength') || hasError('description', 'maxlength')"
              [class.border-gray-300]="!hasError('description', 'required') && !hasError('description', 'minlength') && !hasError('description', 'maxlength')"
            ></textarea>
            @if (hasError('description', 'required') || hasError('description', 'minlength') || hasError('description', 'maxlength')) {
              <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('description') }}</p>
            } @else {
              <p class="mt-1 text-sm text-gray-500">Provide detailed product description (1-1000 characters)</p>
            }
          </div>

          <!-- Price Field -->
          <div>
            <label for="price" class="block text-sm font-medium text-gray-700 mb-2">
              Price <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
              <input
                type="number"
                id="price"
                formControlName="price"
                step="0.01"
                min="0"
                placeholder="0.00"
                class="w-full pl-8 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-gray-500"
                [class.border-red-500]="hasError('price', 'required') || hasError('price', 'min')"
                [class.border-gray-300]="!hasError('price', 'required') && !hasError('price', 'min')"
              />
            </div>
            @if (hasError('price', 'required') || hasError('price', 'min')) {
              <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('price') }}</p>
            } @else {
              <p class="mt-1 text-sm text-gray-500">Set product price (minimum $0.01)</p>
            }
          </div>

          <!-- Categories Selection -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Categories <span class="text-red-500">*</span>
            </label>
            <div class="flex flex-wrap gap-2">
              @for (category of availableCategories; track category.id) {
                <button
                  type="button"
                  (click)="toggleCategory(category.id)"
                  [class.bg-blue-600]="isCategorySelected(category.id)"
                  [class.text-white]="isCategorySelected(category.id)"
                  [class.bg-gray-200]="!isCategorySelected(category.id)"
                  [class.text-gray-700]="!isCategorySelected(category.id)"
                  class="px-4 py-2 rounded-lg font-medium transition-colors duration-200 cursor-pointer"
                >
                  {{ category.name }}
                </button>
              }
            </div>
            @if (hasError('categoryIds', 'required')) {
              <p class="mt-1 text-sm text-red-600">At least one category is required</p>
            } @else {
              <p class="mt-1 text-sm text-gray-500">Select one or more categories</p>
            }
          </div>

          <!-- Image URLs -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Image URLs <span class="text-red-500">*</span>
            </label>
            <div class="space-y-3">
              @for (control of imageUrls.controls; track $index; let idx = $index) {
                <div class="flex gap-2">
                  <input
                    type="url"
                    [formControl]="$any(control)"
                    placeholder="https://example.com/image.jpg"
                    class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors placeholder:text-gray-500"
                    [class.border-red-500]="hasArrayError('imageUrls', idx, 'required') || hasArrayError('imageUrls', idx, 'pattern')"
                    [class.border-gray-300]="!hasArrayError('imageUrls', idx, 'required') && !hasArrayError('imageUrls', idx, 'pattern')"
                  />
                  @if (imageUrls.length > 1) {
                    <button
                      type="button"
                      (click)="removeImageUrl(idx)"
                      class="px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors duration-200 cursor-pointer"
                      title="Remove image"
                    >
                      <ng-icon name="lucideX" />
                    </button>
                  }
                </div>
                @if (hasArrayError('imageUrls', idx, 'required')) {
                  <p class="text-sm text-red-600">Image URL is required</p>
                }
                @if (hasArrayError('imageUrls', idx, 'pattern')) {
                  <p class="text-sm text-red-600">Please enter a valid URL (http:// or https://)</p>
                }
              }
            </div>
            <button
              type="button"
              (click)="addImageUrl()"
              class="mt-3 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors duration-200 flex items-center gap-2 cursor-pointer"
            >
              <ng-icon name="lucidePlus" />
              Add Another Image
            </button>
            <p class="mt-1 text-sm text-gray-500">Add one or more image URLs for this product</p>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-lg flex justify-end gap-3">
          <button
            type="button"
            (click)="cancel()"
            [disabled]="isSaving()"
            class="px-4 py-2 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"
          >
            Cancel
          </button>
          <button
            type="submit"
            [disabled]="productForm.invalid || isSaving()"
            class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 cursor-pointer"
          >
            @if (isSaving()) {
              <div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
            }
            {{ submitButtonText }}
          </button>
        </div>
      </form>
    </div>
  }
</div>
